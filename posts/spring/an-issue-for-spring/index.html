<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>å‘springæäº¤äº†ä¸€ä¸ªissue - æš—å¤œé›¶æ˜Ÿ</title><meta name="Description" content="æš—å¤œé›¶æ˜Ÿï¼Œjavaç¨‹åºå‘˜ã€‚è¿™é‡Œæ˜¯æˆ‘çš„ä¸ªäººåšå®¢ï¼Œäº¤æµæŠ€æœ¯ï¼Œåˆ†äº«ç»éªŒã€‚"><meta property="og:title" content="å‘springæäº¤äº†ä¸€ä¸ªissue" />
<meta property="og:description" content="æ˜¨å¤©ç»™springæäº†ä¸€ä¸ªissueï¼Œè¿™ä¸ªé—®é¢˜åœ¨ å£°æ˜å¼äº‹åŠ¡æ³¨æ„äº‹é¡¹ ä¸­æœ‰æè¿°è¿‡ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wlizhi.cc/posts/spring/an-issue-for-spring/" />
<meta property="og:image" content="https://wlizhi.cc/logo.png"/>
<meta property="article:published_time" content="2020-12-11T12:47:01+08:00" />
<meta property="article:modified_time" content="2020-12-11T12:47:01+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://wlizhi.cc/logo.png"/>

<meta name="twitter:title" content="å‘springæäº¤äº†ä¸€ä¸ªissue"/>
<meta name="twitter:description" content="æ˜¨å¤©ç»™springæäº†ä¸€ä¸ªissueï¼Œè¿™ä¸ªé—®é¢˜åœ¨ å£°æ˜å¼äº‹åŠ¡æ³¨æ„äº‹é¡¹ ä¸­æœ‰æè¿°è¿‡ã€‚"/>
<meta name="application-name" content="æš—å¤œé›¶æ˜Ÿ">
<meta name="apple-mobile-web-app-title" content="æš—å¤œé›¶æ˜Ÿ"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://wlizhi.cc/posts/spring/an-issue-for-spring/" /><link rel="prev" href="https://wlizhi.cc/posts/spring/21-load-servlet-container-initializer-on-startup/" /><link rel="next" href="https://wlizhi.cc/posts/spring/22-enable-web-mvc-main-embedded-tomcat/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "å‘springæäº¤äº†ä¸€ä¸ªissue",
        "inLanguage": "",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/wlizhi.cc\/posts\/spring\/an-issue-for-spring\/"
        },"genre": "posts","keywords": "springæºç , springé—®é¢˜","wordcount":  2931 ,
        "url": "https:\/\/wlizhi.cc\/posts\/spring\/an-issue-for-spring\/","datePublished": "2020-12-11T12:47:01+08:00","dateModified": "2020-12-11T12:47:01+08:00","publisher": {
            "@type": "Organization",
            "name": "Wlizhi"},"author": {
                "@type": "Person",
                "name": "Wlizhi"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="æš—å¤œé›¶æ˜Ÿ"><span class="header-title-pre"><i class='far fa-moon fa-fw'></i></span>æš—å¤œé›¶æ˜Ÿ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/message-board/"> ç•™è¨€ </a><a class="menu-item" href="/about/"> å…³äº </a><a class="menu-item" href="https://github.com/wlizhi" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><a class="menu-item" href="https://gitee.com/wlizhi" title="Gitee" rel="noopener noreffer" target="_blank"><i class='fab fa-git fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="ç‚¹å‡»æœç´¢..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="æš—å¤œé›¶æ˜Ÿ"><span class="header-title-pre"><i class='far fa-moon fa-fw'></i></span>æš—å¤œé›¶æ˜Ÿ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="ç‚¹å‡»æœç´¢..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/message-board/" title="">ç•™è¨€</a><a class="menu-item" href="/about/" title="">å…³äº</a><a class="menu-item" href="https://github.com/wlizhi" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a class="menu-item" href="https://gitee.com/wlizhi" title="Gitee" rel="noopener noreffer" target="_blank"><i class='fab fa-git fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">å‘springæäº¤äº†ä¸€ä¸ªissue</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://wlizhi.cc" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Wlizhi</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/spring/"><i class="far fa-folder fa-fw"></i>spring</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-12-11">2020-12-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 2931 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 6 åˆ†é’Ÿ&nbsp;<span id="/posts/spring/an-issue-for-spring/" class="leancloud_visitors" data-flag-title="å‘springæäº¤äº†ä¸€ä¸ªissue">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;æ¬¡é˜…è¯»
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
            </div><div class="content" id="content"><p>æ˜¨å¤©ç»™springæäº†ä¸€ä¸ªissueï¼Œè¿™ä¸ªé—®é¢˜åœ¨ <a href="https://wlizhi.cc/posts/spring/16-transaction-declare-attention/" target="_blank" rel="noopener noreffer">å£°æ˜å¼äº‹åŠ¡æ³¨æ„äº‹é¡¹</a> ä¸­æœ‰æè¿°è¿‡ã€‚</p>
<p>å…³äºspringå£°æ˜å¼äº‹åŠ¡ä¼ æ’­è¡Œä¸º <code>REQUIRES_NEW</code>ï¼Œå¦‚æœä¸åšé¢å¤–å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æ•°æ®åº“è¿æ¥è¢«å ç”¨çš„é—®é¢˜ã€‚ä¸€ç›´æä¸æ˜ç™½ï¼Œè¿™é‡Œéšè—ç€å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªä¼ æ’­è¡Œä¸ºã€‚äºæ˜¯å°±å°†é—®é¢˜æäº¤ç»™äº†springå®˜æ–¹ã€‚</p>
<p><a href="https://github.com/spring-projects/spring-framework/issues/26250" target="_blank" rel="noopener noreffer">issueé“¾æ¥ä¼ é€é—¨</a></p>
<p>å½“å¤šä¸ªçº¿ç¨‹äº‰ç”¨èµ„æºæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¿…é¡»åœ¨ç»“æŸä»»åŠ¡ä¹‹å‰æŠ¢å å¤šä¸ªèµ„æºï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéšæ‚£ã€‚å› ä¸ºæ­¤æ–¹æ³•å¯èƒ½å¯¼è‡´å¤šä¸ªçº¿ç¨‹ä»…æŠ¢å¤ºå®ƒä»¬éœ€è¦çš„éƒ¨åˆ†èµ„æºï¼Œå®ƒä»¬æ— æ³•è·å¾—æ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºè€Œé‡Šæ”¾æ‰€è·å¾—çš„ä¸œè¥¿ã€‚ä½†æ˜¯ï¼Œåˆ°è¿™ä¸ªæ—¶å€™ï¼Œèµ„æºå·²ç»ç”¨å°½äº†ã€‚</p>
<p>springå£°æ˜å¼äº‹åŠ¡ä¸­çš„ä¼ æ’­è¡Œä¸º <code>REQUIRES_NEW</code> æ­£æ˜¯ä»¥ä¸Šæƒ…å†µçš„è¡¨ç°ã€‚</p>
<p>æœ€ç»ˆçš„æ²Ÿé€šç»“æœæˆªå›¾ï¼š</p>
<p><figure><a class="lightgallery" href="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png" title="æ²Ÿé€šç»“æœæˆªå›¾" data-thumbnail="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png" data-sub-html="<h2>spring-issue-from-github.png</h2><p>æ²Ÿé€šç»“æœæˆªå›¾</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png"
            data-srcset="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png 1.5x, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png 2x"
            data-sizes="auto"
            alt="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-issue-from-github.png" />
    </a><figcaption class="image-caption">spring-issue-from-github.png</figcaption>
    </figure></p>
<p>è¯¦ç»†çš„æ²Ÿé€šè¿‡ç¨‹ï¼š</p>
<p>æœ€åˆæäº¤çš„issueï¼Œæˆ‘ä»…ä»…å‘äº†ä¸€æ®µä¼ªä»£ç ã€‚å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">A method that opens a transaction calls another method that starts a new transactionï¼Œif all connections are exhausted before the last new transaction method is executed,then all threads in the process will blockï¼Œthis process will fail.

Pseudo codeï¼š

@Transactional
methodA(){
    // All the threads that started the transaction were executed here, but the connection was exhausted.
    // The latter method execution will get a new connection,but it will never get it.
    @Transactional(propagation=Propagation.REQUIRES_NEW)
    methodB(){
    }
}
</code></pre></td></tr></table>
</div>
</div><p>åˆšå¼€å§‹å¯¹æ–¹å¹¶æ²¡æœ‰è®¤çœŸçš„æŸ¥çœ‹ï¼Œä»…å›å¤<code>What's the problem?</code>ã€‚ä¹‹åæ•°æ¬¡çš„å›å¤è²Œä¼¼ä¸åœ¨ä¸€ä¸ªé¢‘é“ã€‚ä¹Ÿè®¸æ˜¯å› ä¸ºæ²Ÿé€šæ—¶ç¤¼è²Œçš„åŸå› ã€åˆæˆ–è€…æ˜¯æˆ‘é—®é¢˜æè¿°çš„ä¸å¤Ÿæ¸…æ¥šã€‚ç»è¿‡å‡ æ¬¡æ²Ÿé€šåï¼Œå·®ç‚¹æŠŠå¯¹æ–¹æƒ¹æ¯›äº†ï¼Œå¯¹æ–¹å›å¤é“ï¼šè¿™é‡Œä¸æ˜¯è®ºå›ï¼Œå¦‚æœæ‚¨è®¤ä¸ºæ˜¯é”™è¯¯ï¼Œè¯·ç²˜è´´æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœæ‚¨è®¤ä¸ºæ˜¯æ”¹è¿›ï¼Œè¯·æäº¤PRï¼Œè®¨è®ºåˆ°æ­¤ä¸ºæ­¢ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åŸæ–‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">It&#39;s not forum here, if you think it&#39;s a bug please paste test case, if you think it&#39;s an improvement please submit PR, end of discussion.
</code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°å¯¹æ–¹ä¸è€çƒ¦äº†ï¼Œè€ƒè™‘åˆ°è‡ªå·±è¯´è¯æ–¹å¼çš„é—®é¢˜ï¼Œä¸€ç•ªæ€è™‘åï¼Œå†³å®šå†å›å¤ä¸€ä¸‹ã€‚å›å¤å†…å®¹å°½å¯èƒ½å°†è¿™ä¸ªæ½œåœ¨é—®é¢˜æè¿°æ¸…æ¥šã€‚
å›å¤å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Sorry, I didn&#39;t make it clear. This is the test code, where it blocks the real process. Methodb() will never execute.
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼šæŠ±æ­‰ï¼Œæ˜¯æˆ‘æ²¡æœ‰è¡¨è¾¾æ¸…æ¥šã€‚è¿™æ˜¯æµ‹è¯•ä»£ç ï¼Œå®ƒé˜»å¡äº†æ•´ä¸ªè¿›ç¨‹ã€‚ methodB() å°†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@slf4j</span>
<span class="nd">@service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropagationExampleServiceImpl</span> <span class="kd">implements</span> <span class="n">PropagationExampleService</span> <span class="o">{</span>
<span class="nd">@Autowired</span>
<span class="n">PropagationExampleService</span> <span class="n">service</span><span class="o">;</span>

<span class="nd">@Transactional</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">methodA</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
	<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;methodA&#34;</span><span class="o">);</span>
	<span class="n">service</span><span class="o">.</span><span class="na">methodB</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRES_NEW</span><span class="o">)</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">methodB</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;methodB&#34;</span><span class="o">);</span>
	<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropagationExampleServiceTest</span> <span class="o">{</span>
<span class="nd">@Autowired</span>
<span class="n">PropagationExampleService</span> <span class="n">service</span><span class="o">;</span>
<span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">10</span><span class="o">,</span> <span class="n">10</span><span class="o">,</span> <span class="n">60</span><span class="o">,</span>
<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="n">1000</span><span class="o">));</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">methodATest</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
		<span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">service</span><span class="o">.</span><span class="na">methodA</span><span class="o">();</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>
	<span class="n">LockSupport</span><span class="o">.</span><span class="na">park</span><span class="o">();</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿æ¥æ± é…ç½®åŠæ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">spring:
datasource:
name: druidDataSource
type: com.alibaba.druid.pool.DruidDataSource
druid:
max-active: 10

Here is the log:
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-1] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-2] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-5] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-6] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-8] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-9] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-3] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [ool-1-thread-10] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-7] c.j.s.s.i.PropagationExampleServiceImpl : methodA
2020-12-11 10:15:56.385 INFO 10864 --- [pool-1-thread-4] c.j.s.s.i.PropagationExampleServiceImpl : methodA
</code></pre></td></tr></table>
</div>
</div><hr>
<p>å¥½å§ï¼Œå¯¹æ–¹ä»¥ä¸ºæ˜¯æˆ‘ä½¿ç”¨è¿‡ç¨‹é‡åˆ°äº†é—®é¢˜ï¼Œåœ¨åƒä»–æ±‚åŠ©ï¼Œå›å¤é“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">I think the result is expected, you should increase max-active &gt; concurrency, so If you change max-active to 21, it will pass, waiting for your confirmation.
You should set a max-wait on dataSource, then getConnection will timeout instead of endless blocking.
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼šæˆ‘è®¤ä¸ºç»“æœæ˜¯é¢„æœŸçš„ï¼Œæ‚¨åº”è¯¥å¢åŠ  max-active å¹¶å‘æ€§ï¼Œå› æ­¤ï¼Œå¦‚æœå°†max-activeæ›´æ”¹ä¸º21ï¼Œå®ƒå°†é€šè¿‡ï¼Œç­‰å¾…ç¡®è®¤ã€‚æ‚¨åº”è¯¥åœ¨dataSourceä¸Šè®¾ç½®ä¸€ä¸ªmax-waitï¼Œç„¶ågetConnectionå°†è¶…æ—¶è€Œä¸æ˜¯æ— é™é˜»å¡ã€‚</p>
<hr>
<p>ä»¥ä¸‹æ˜¯æˆ‘çš„å›å¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">I know, I just want to express that. In fact, the number of connections in the connection pool is generally not large. In the above example, only one layer is nested. If there are multiple layers of newly started transactions in the code, only a small amount of concurrency is needed to trigger the above result.

I just think that when multiple threads compete for resources, each thread must grab multiple resources before ending the task, which may be a hidden danger.

Because this method may cause multiple threads to rob only a part of the resources they need. They can&#39;t release what they have acquired without getting all the resources they need. By this time, however, resources have been exhausted.
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼šæˆ‘çŸ¥é“ï¼Œæˆ‘åªæƒ³è¡¨è¾¾è¿™ä¸€ç‚¹ã€‚å®é™…ä¸Šï¼Œè¿æ¥æ± ä¸­çš„è¿æ¥æ•°é€šå¸¸ä¸å¤§ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä»…åµŒå¥—äº†ä¸€å±‚ã€‚å¦‚æœä»£ç ä¸­æœ‰å¤šå±‚æ–°å¯åŠ¨çš„äº‹åŠ¡ï¼Œåˆ™åªéœ€å°‘é‡çš„å¹¶å‘å³å¯è§¦å‘ä¸Šè¿°ç»“æœã€‚æˆ‘åªæ˜¯è®¤ä¸ºï¼Œå½“å¤šä¸ªçº¿ç¨‹äº‰ç”¨èµ„æºæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¿…é¡»åœ¨ç»“æŸä»»åŠ¡ä¹‹å‰æŠ¢å å¤šä¸ªèµ„æºï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéšæ‚£ã€‚å› ä¸ºæ­¤æ–¹æ³•å¯èƒ½å¯¼è‡´å¤šä¸ªçº¿ç¨‹ä»…æŠ¢å¤ºå®ƒä»¬éœ€è¦çš„éƒ¨åˆ†èµ„æºã€‚ä»–ä»¬æ— æ³•è·å¾—æ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºè€Œé‡Šæ”¾æ‰€è·å¾—çš„ä¸œè¥¿ã€‚ä½†æ˜¯ï¼Œåˆ°è¿™ä¸ªæ—¶å€™ï¼Œèµ„æºå·²ç»ç”¨å°½äº†ã€‚</p>
<hr>
<p>å¯¹æ–¹å›å¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Your test blocked because you didn&#39;t set timeout for ds.getConnection(), for example maxWait for druid and connectionTimeout for HikariCP.
It&#39;s really nothing to do with spring transaction.
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼šç”±äºæœªä¸ºds.getConnectionï¼ˆï¼‰è®¾ç½®è¶…æ—¶ï¼ˆä¾‹å¦‚ï¼Œä¸ºdruidè®¾ç½®äº†maxWaitï¼Œä¸ºHikariCPè®¾ç½®äº†connectionTimeoutï¼‰ï¼Œå› æ­¤æµ‹è¯•è¢«é˜»æ­¢ã€‚ç¡®å®ä¸spring transactionæ— å…³ã€‚</p>
<p>å¯¹æ–¹çš„å›å¤è®©æˆ‘è§‰å¾—æœ‰ç‚¹ç”©é”…çš„æ„æ€ã€‚ğŸ˜¢</p>
<p>æœ€ç»ˆå†³å®šï¼ŒæŠŠæˆ‘çš„æ„å›¾æ•´ä½“å‘è¿‡å»ï¼Œç„¶åå°±ä¸å†çº ç»“äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">I&#39;m sorry to have taken you so long.

I just want to put forward what I think may be hidden dangers. It&#39;s not that I have encountered problems in use. I just don&#39;t quite understand why this place is designed in this way.

Even if Max wait is set here, the above situation may occur. It&#39;s just going to wait for a while, not the whole process, but it&#39;s bad enough.

For this reason, I choose to avoid using REQUIRES_NEW, if I need to start a new transaction in a method, I will use asynchronous or transactionSynchronization.afterCommit ()ã€‚

You may say that the outer method will not be able to sense the exception, but why should it? These are two transactions. If I need the outer layer to sense the inner layer&#39;s anomaly, I can use NESTED.
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼š
å¾ˆæŠ±æ­‰è€½è¯¯ä½ è¿™ä¹ˆä¹…ã€‚</p>
<p>æˆ‘åªæƒ³æå‡ºæˆ‘è®¤ä¸ºå¯èƒ½å­˜åœ¨çš„éšæ‚£ã€‚å¹¶ä¸æ˜¯è¯´æˆ‘åœ¨ä½¿ç”¨ä¸­é‡åˆ°äº†é—®é¢˜ã€‚æˆ‘åªæ˜¯ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¿™ä¸ªåœ°æ–¹æ˜¯è¿™æ ·è®¾è®¡çš„ã€‚</p>
<p>å³ä½¿åœ¨è¿™é‡Œè®¾ç½®äº†Max waitï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿä¸Šè¿°æƒ…å†µã€‚åªæ˜¯è¦ç­‰ä¸€æ®µæ—¶é—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰ï¼Œä½†è¿™ä¹Ÿè¶³å¤Ÿç³Ÿç³•äº†ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä¼šé€‰æ‹©å°½å¯èƒ½é¿å…ä½¿ç”¨REQUIRES_NEWï¼Œå¦‚æœæˆ‘å¿…é¡»åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å¯åŠ¨ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œæˆ‘å°†ä½¿ç”¨asynchronousæˆ–transaActionSynchronization.afterCommit()å°†ä¸¤ä¸ªäº‹åŠ¡æäº¤éš”ç¦»ã€‚</p>
<p>æ‚¨å¯èƒ½ä¼šè¯´ï¼Œå¤–éƒ¨æ–¹æ³•å°†æ— æ³•æ„ŸçŸ¥å¼‚å¸¸ã€‚ä½†ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿè¿™æœ¬å°±æ˜¯ä¸¤ä¸ªäº‹åŠ¡ã€‚å¦‚æœæˆ‘éœ€è¦å¤–å±‚æ¥æ„ŸçŸ¥å†…å±‚çš„å¼‚å¸¸ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨NESTEDã€‚</p>
<hr>
<p>æœ€ç»ˆå¯¹æ–¹ç»™äº†ä¸€ä¸ªæˆ‘æ„æƒ³ä¸åˆ°çš„å›å¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">I admit your title &#34;Propagation.REQUIRES_NEW May cause all connections to be occupied&#34;.
application should deal REQUIRES_NEW properly, there is no bug or improve space here, at most adding note in docs. Do you agree?
</code></pre></td></tr></table>
</div>
</div><p>ç™¾åº¦ç¿»è¯‘ï¼šæˆ‘æ‰¿è®¤æ‚¨çš„æ ‡é¢˜â€œ Propagation.REQUIRES_NEWå¯èƒ½å¯¼è‡´æ‰€æœ‰è¿æ¥è¢«å ç”¨â€ã€‚åº”ç”¨ç¨‹åºåº”è¯¥æ­£ç¡®å¤„ç†REQUIRES_NEWï¼Œæ­¤å¤„æ²¡æœ‰é”™è¯¯æˆ–æ²¡æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæœ€å¤šåªèƒ½åœ¨æ–‡æ¡£ä¸­æ·»åŠ æ³¨é‡Šã€‚ä½ åŒæ„å—ï¼Ÿ</p>
<hr>
<p>å¦‚æœé¡¹ç›®ä¸­æœ‰äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºè®¾ç½®ä¸º <code>REQUIRES_NEW</code>ï¼Œä¸€å®šè¦ä»”ç»†æ€è€ƒå½“å‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯å¦çœŸçš„éœ€è¦æ–°å¯äº‹åŠ¡ï¼Œæˆ–è€…å¦‚æœæ‰“ä¹±å¤–å›´æ–¹æ³•å’Œå®ƒä¹‹é—´çš„æ‰§è¡Œé¡ºåºï¼Œæ˜¯å¦ä¼šæœ‰æ‰€å½±å“ï¼Ÿè€ƒè™‘è¿™äº›é—®é¢˜çš„ç›®çš„å°±æ˜¯ä¸ºäº†ï¼Œå°½å¯èƒ½é¿å…è¿™ç§ä¼ æ’­è¡Œä¸ºçš„ä½¿ç”¨ã€‚å¦‚æœçœŸçš„é¿ä¸å¼€ï¼Œå°±åšå¼‚æ­¥å¤„ç†æˆ–è€…ä½¿ç”¨äº‹åŠ¡åŒæ­¥å™¨ï¼Œè¿›è¡Œåç½®å¤„ç†ã€‚</p>
<p>å¦‚æœè¿™ç§æ–¹å¼è¿˜æ˜¯ä¼šæ‰“ä¹±åŸæœ‰ä¸šåŠ¡ï¼Œå¿…é¡»å¾—ä½¿ç”¨ <code>REQUIRES_NEW</code>ï¼Œä¹Ÿä¸å…è®¸åšå…¶ä»–å¤„ç†ï¼ˆæˆ‘å®åœ¨æƒ³ä¸åˆ°è¿™ç§åœºæ™¯ï¼‰ï¼Œé‚£æœ€å¥½å¯¹å…¶è¿›è¡Œé™æµã€‚ç†è®ºä¸Šè¿›ç¨‹ä¸­æ‰€æœ‰æ–°å¯äº‹åŠ¡çš„æ–¹æ³•ä¸ªæ•°è¦å°äºè¿æ¥æ± è¿æ¥æ•°ã€‚å…è®¸çš„æœ€å¤§å¹¶å‘é‡è¦å°äºè¿æ¥æ± è¿æ¥æ•°é™¤ä»¥è¿™ç§æ–¹æ³•çš„ä¸ªæ•°ï¼Œå½“ç„¶è¿™æ˜¯ä¸‹ä¸‹ç­–ã€‚æœ€ç»ˆè¿™äº›æ–¹æ³•ä¼šä»¥ææ…¢çš„é€Ÿåº¦è¿›è¡Œï¼Œç”šè‡³è¿˜ä¸å¦‚ç›´æ¥å¡åˆ°ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚èƒ½æ‹†åˆ†æˆä¸¤ä¸ªäº‹åŠ¡è§£å†³çš„é—®é¢˜ï¼Œä½¿ç”¨ä¸€ä¸ªäº‹åŠ¡ä¸€å®šä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ã€‚</p>
<p>æˆ‘ä¸ªäººè®¤ä¸º <code>REQUIRES_NEW</code> è¿™ç§ä¼ æ’­è¡Œä¸ºæœºåˆ¶æ˜¯æœ‰ä¸€å®šé—®é¢˜çš„ï¼Œè‡³å°‘è¿™ä¸ªé—®é¢˜åœ¨ä¸Šé¢ä»£ç æ¡ˆä¾‹ä¸­å·²ç»è¡¨ç°å‡ºæ¥äº†ï¼Œè€Œä¸”è§¦å‘çš„å‡ ç‡æé«˜ã€‚æ›¿ä»£è¿™ç§ä¼ æ’­è¡Œä¸ºçš„æ‰‹æ®µå¾ˆå¤šï¼Œä½•å¿…è¦ç›´æ¥ä½¿ç”¨è¿™ç§ä¼ æ’­è¡Œä¸ºï¼ŒåŸ‹ä¸‹ä¸€ä¸ªé¡¹ç›®éšæ—¶å¯èƒ½å®•æœºï¼ˆå¦‚æœè®¾ç½®äº†è¶…æ—¶ï¼Œå‰æ–‡ä¸­è¯´çš„ç»“æœè¢«è§¦å‘æ—¶ï¼Œä¼šä¸€ç›´å¡é¡¿åˆ°è¿æ¥è¶…æ—¶ï¼Œäº‹åŠ¡å›æ»šã€‚ï¼‰çš„éšæ‚£å‘¢ï¼Ÿ</p>
<p>ä¹‹æ‰€ä»¥æ²¡æœ‰ç›´æ¥å‘ issue æˆªå›¾ï¼Œæ˜¯å› ä¸ºæ–‡ç« ä½¿ç”¨mdæ–‡æ¡£å†™çš„ï¼Œæäº¤åˆ°å…¶ä»–åšå®¢ç½‘ç«™æ—¶ï¼Œå›¾ç‰‡é“¾æ¥å¯èƒ½ä¼šæ— æ³•åŠ è½½ã€‚æ‰€ä»¥ä»¥æ–‡å­—çš„å½¢å¼å…ˆå¤åˆ¶ä¸‹æ¥ã€‚åé¢å†é™„ä¸Šéƒ¨åˆ†æˆªå›¾ã€‚</p>
<p>githubéƒ¨åˆ†æ²Ÿé€šæ—¶çš„æˆªå›¾</p>
<p><figure><a class="lightgallery" href="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png" title="spring-github-issue-transaction-01" data-thumbnail="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png" data-sub-html="<h2>spring-github-issue-transaction-01</h2><p>spring-github-issue-transaction-01</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png"
            data-srcset="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png 1.5x, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png 2x"
            data-sizes="auto"
            alt="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-01.png" />
    </a><figcaption class="image-caption">spring-github-issue-transaction-01</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png" title="spring-github-issue-transaction-02" data-thumbnail="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png" data-sub-html="<h2>spring-github-issue-transaction-02</h2><p>spring-github-issue-transaction-02</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png"
            data-srcset="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png 1.5x, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png 2x"
            data-sizes="auto"
            alt="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-02.png" />
    </a><figcaption class="image-caption">spring-github-issue-transaction-02</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png" title="spring-github-issue-transaction-03" data-thumbnail="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png" data-sub-html="<h2>spring-github-issue-transaction-03</h2><p>spring-github-issue-transaction-03</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png"
            data-srcset="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png 1.5x, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png 2x"
            data-sizes="auto"
            alt="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-03.png" />
    </a><figcaption class="image-caption">spring-github-issue-transaction-03</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png" title="spring-github-issue-transaction-04" data-thumbnail="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png" data-sub-html="<h2>spring-github-issue-transaction-04</h2><p>spring-github-issue-transaction-04</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png"
            data-srcset="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png 1.5x, https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png 2x"
            data-sizes="auto"
            alt="https://oss.wlizhi.cc/blog/spring/spring-github-transaction-propagation-issue/spring-github-issue-transaction-04.png" />
    </a><figcaption class="image-caption">spring-github-issue-transaction-04</figcaption>
    </figure></p></div>

        <div id="donateDiv"><a id="donate">æ‰“èµ</a></div>
<div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2020-12-11</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/spring%E6%BA%90%E7%A0%81/">springæºç </a>,&nbsp;<a href="/tags/spring%E9%97%AE%E9%A2%98/">springé—®é¢˜</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/spring/21-load-servlet-container-initializer-on-startup/" class="prev" rel="prev" title="21 webå®¹å™¨å¯åŠ¨æ—¶ServletContainerInitializerçš„åŠ è½½"><i class="fas fa-angle-left fa-fw"></i>21 webå®¹å™¨å¯åŠ¨æ—¶ServletContainerInitializerçš„åŠ è½½</a>
            <a href="/posts/spring/22-enable-web-mvc-main-embedded-tomcat/" class="next" rel="next" title="22 MVCçš„æ”¯æŒå…¥å£åŠåµŒå…¥å¼Tomcatçš„ä½¿ç”¨">22 MVCçš„æ”¯æŒå…¥å£åŠåµŒå…¥å¼Tomcatçš„ä½¿ç”¨<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://wlizhi.cc" target="_blank">Wlizhi</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href='https://beian.miit.gov.cn/' target='_blank'>è±«ICPå¤‡17048163å·<a/></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{"valine":{"appId":"4yIHB0Rs1r3ykDVxayI5nqj3-gzGzoHsz","appKey":"ALr4H1hlK94girLDEUCGmp3o","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-cn","meta":["nick","mail","link"],"pageSize":5,"placeholder":"æ˜µç§°æ è¾“å…¥QQï¼Œä¼šä½¿ç”¨QQæ˜µç§°å’Œå¤´åƒã€å¹¶è‡ªåŠ¨è¡¥å……QQé‚®ç®±åˆ°é‚®ç®±æ ã€‚\r\næ­£ç¡®å¡«å†™é‚®ç®±æ›´å®¹æ˜“åŠæ—¶å¾—åˆ°å›å¤ã€‚\r\nè¯´ç‚¹ä»€ä¹ˆå§...","recordIP":true,"visitor":true}},"search":{"algoliaAppID":"1U459KF21F","algoliaIndex":"LoveItSite","algoliaSearchKey":"0433ffe95d71201a4f7c3e04b0125ac5","highlightTag":"em","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="/js/donate.js"></script></body>
</html>
